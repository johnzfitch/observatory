# Phase 7: Analyze Button Progress Bar

## Time: 1 hour

## Files: index.html, css/styles.css

## Concept

Transform the Analyze button into a progress bar during analysis.
Button fills from left to right as each model completes.
Shows current model name + progress count.

## HTML Structure

```html
<button id="analyzeBtn" class="analyze-btn">
  <span class="analyze-btn-text">Analyze Image</span>
  <div class="analyze-btn-progress">
    <div class="analyze-btn-progress-fill"></div>
    <span class="analyze-btn-progress-text">Style Detector (1/4)</span>
  </div>
</button>
```

## CSS

```css
/* Analyze Button with Progress */
.analyze-btn {
  position: relative;
  overflow: hidden;
  min-width: 200px;
  padding: 12px 24px;
  font-size: 1rem;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: var(--accent, #00ff88);
  color: #000;
  transition: all 0.2s;
}

.analyze-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.analyze-btn:not(:disabled):hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
}

/* Default state - show text, hide progress */
.analyze-btn-text {
  display: block;
}

.analyze-btn-progress {
  display: none;
  position: absolute;
  inset: 0;
  align-items: center;
  justify-content: center;
}

/* Analyzing state - hide text, show progress */
.analyze-btn.analyzing .analyze-btn-text {
  display: none;
}

.analyze-btn.analyzing .analyze-btn-progress {
  display: flex;
}

.analyze-btn.analyzing {
  background: var(--bg-secondary, #1a1a2e);
  color: #fff;
  cursor: wait;
}

/* Progress fill bar */
.analyze-btn-progress-fill {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 0%;
  background: var(--accent, #00ff88);
  opacity: 0.25;
  transition: width 0.4s ease-out;
}

/* Progress text */
.analyze-btn-progress-text {
  position: relative;
  z-index: 1;
  font-size: 0.875rem;
}
```

## JavaScript

```js
const analyzeBtn = document.getElementById('analyzeBtn');
const progressFill = analyzeBtn.querySelector('.analyze-btn-progress-fill');
const progressText = analyzeBtn.querySelector('.analyze-btn-progress-text');

function startButtonProgress() {
  analyzeBtn.classList.add('analyzing');
  analyzeBtn.disabled = true;
  progressFill.style.width = '0%';
}

function updateButtonProgress(modelId, current, total) {
  const modelName = getModelDisplayName(modelId);
  const percent = (current / total) * 100;
  
  progressFill.style.width = `${percent}%`;
  progressText.textContent = `${modelName} (${current}/${total})`;
}

function endButtonProgress() {
  analyzeBtn.classList.remove('analyzing');
  analyzeBtn.disabled = false;
  progressFill.style.width = '0%';
}

// Hook into analysis flow
async function startAnalysis() {
  startButtonProgress();
  
  try {
    let completed = 0;
    const total = 4;  // or models.length
    
    for (const model of models) {
      updateButtonProgress(model.id, completed + 1, total);
      
      await runModel(model);
      completed++;
      
      // Update to show completion
      updateButtonProgress(model.id, completed, total);
    }
    
    displayResults(results);
    
  } catch (error) {
    if (error.name !== 'AbortError') {
      showError('Analysis failed');
    }
  } finally {
    endButtonProgress();
  }
}
```

## Integration with InferenceEngine

If InferenceEngine handles the loop internally, add a progress callback:

```js
// InferenceEngine.js
async analyze(image, onProgress) {
  const results = [];
  const total = this.models.length;
  
  for (let i = 0; i < this.models.length; i++) {
    const model = this.models[i];
    
    // Report starting this model
    if (onProgress) {
      onProgress({
        modelId: model.id,
        current: i + 1,
        total: total,
        phase: 'running'
      });
    }
    
    const result = await this.runModel(model, image);
    results.push(result);
  }
  
  return results;
}

// Usage in index.html
const results = await inferenceEngine.analyze(image, (progress) => {
  updateButtonProgress(progress.modelId, progress.current, progress.total);
});
```

## Visual States

| State | Button Appearance |
|-------|------------------|
| Initial | Green, "Analyze Image" |
| No image | Gray/disabled, "Upload an image" |
| Models loading | Gray/disabled, "Loading models... 2/4" |
| Ready | Green, "Analyze Image" |
| Analyzing | Dark bg, progress fill, "Style Detector (1/4)" |
| Complete | Returns to Ready state |

## Verify

1. Upload image
2. Click Analyze
3. Button transforms to progress bar
4. Fill animates smoothly 0% → 25% → 50% → 75% → 100%
5. Model names update correctly
6. Button returns to normal after completion
7. Works on cancel (Remove button)

## Done when

- Button shows progress during analysis
- Fill animation is smooth
- Model names display correctly
- Button resets after completion or cancel
- No visual glitches
